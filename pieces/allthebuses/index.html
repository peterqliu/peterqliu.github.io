
<html>
<head>
    <meta charset='utf-8' />
    <title>allthebuses</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.6.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.54.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/94/three.min.js'></script>
<script src="https://unpkg.com/three@0.106.2/examples/js/loaders/GLTFLoader.js"></script>


<!--     <script src='munirouteconfig.js'></script>
 -->    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,300' rel='stylesheet' type='text/css'>
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        #controls { position:absolute; top:0; left:0; }
    </style>
    <script>

        var s = {
            center: [-122.437, 37.782],
            activeRoute: false,
            routeDrawStart: Date.now(),
            utils: {
                degreeify: radians =>{
                    radians = radians || 0;
                    return radians * 360/(Math.PI*2)
                },

                radify: deg => 2*Math.PI * deg/360
            }
        }

        var c = {
            animationDuration: 500,
            emptyGeojson: turf.featureCollection([]),
            color: {
                'IB':'rgba(170, 51, 69, 1)',
                'OB': 'rgba(65, 166, 178, 1)',
                'weak':'#BAB49D'
            },
            routeData:{

            }
        }
        c.style = {
            focus:[
                ['route', 'line-width', 5],
                ['stops', 'circle-stroke-width', 5],
                ['stops', 'circle-radius', 5],
                ['buses', 'circle-color', c.color.weak],
                ['bus_labels', 'text-opacity', 1]
            ],
            active:[
                ['route', 'line-width', 5],
                ['stops', 'circle-stroke-width', 0],
                ['stops', 'circle-radius', 0],
                ['buses', 'circle-color', c.color.weak],
                ['bus_labels', 'text-opacity', 0]
            ],
            inactive:[
                ['route', 'line-width', 0],
                ['stops', 'circle-stroke-width', 0],
                ['stops', 'circle-radius', 0],
                ['buses', 'circle-color', {
                    'property': 'direction',
                    'type':'categorical',
                    'stops':[['IB', c.color.IB], ['OB', c.color.OB]]
                }],
                ['bus_labels', 'text-opacity', 0]
            ]
        }
        function setState(key, value){

            if (key === 'activeRoute'){

                var newRoute = value ? value.routeId+'-'+value.direction+'-'+value.directionId : false

                //if already highlighting
                if (s.activeRoute){

                    if (newRoute){
                        if (newRoute !== s.activeRoute) updateRoute()
                        s.activeRoute = newRoute
                    }

                    else {
                        s.activeRoute = newRoute
                        updateRoute()
                    }
                }

                //if no current highlight
                else {
                    if (newRoute){
                        s.activeRoute = newRoute
                        updateRoute()
                    }

                    else {

                    }
                }

            }

        }
    </script>


    <body>
        <div id='map'></div>
    </body>
    <script src='map.js'></script>
    <script src='customlayer.js'></script>

    <!-- <script src='3.js'></script> -->
</head>

</html>